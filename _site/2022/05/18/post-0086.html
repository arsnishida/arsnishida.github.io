<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Cron Info for Automatically Running bcl2fastq | ARSN Lab Notebook</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Cron Info for Automatically Running bcl2fastq" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The cron job scheduler is currently setup on mccovey only. Sudo permissions would be required to set it up on bonds and mays if desired. This just involves fiddling with the files, /var/spool/cron/ and /etc/cron.allow." />
<meta property="og:description" content="The cron job scheduler is currently setup on mccovey only. Sudo permissions would be required to set it up on bonds and mays if desired. This just involves fiddling with the files, /var/spool/cron/ and /etc/cron.allow." />
<link rel="canonical" href="http://localhost:4000/2022/05/18/post-0086.html" />
<meta property="og:url" content="http://localhost:4000/2022/05/18/post-0086.html" />
<meta property="og:site_name" content="ARSN Lab Notebook" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-05-18T00:00:00-07:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2022/05/18/post-0086.html"},"url":"http://localhost:4000/2022/05/18/post-0086.html","description":"The cron job scheduler is currently setup on mccovey only. Sudo permissions would be required to set it up on bonds and mays if desired. This just involves fiddling with the files, /var/spool/cron/ and /etc/cron.allow.","dateModified":"2022-05-18T00:00:00-07:00","datePublished":"2022-05-18T00:00:00-07:00","headline":"Cron Info for Automatically Running bcl2fastq","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="ARSN Lab Notebook" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">ARSN Lab Notebook</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Cron Info for Automatically Running bcl2fastq</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2022-05-18T00:00:00-07:00" itemprop="datePublished">May 18, 2022
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>The cron job scheduler is currently setup on mccovey only. Sudo permissions would be required to set it up on bonds and mays if desired. This just involves fiddling with the files, <code class="language-plaintext highlighter-rouge">/var/spool/cron/</code> and <code class="language-plaintext highlighter-rouge">/etc/cron.allow</code>.</p>

<p>Here is the one cron job scheduled to look for new obnix runs.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SHELL=/bin/bash
0 * * * * source /home/groups/oroaklab/Modules/default/init/bash; source /home/groups/oroaklab/nishida/cron/setup/profile; /home/groups/oroaklab/nishida/scripts/check_obnix.sh &gt; /home/groups/oroaklab/nishida/cron/check_obnix.cronlog
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">0 * * * *</code> part signifies to run this at the top of every hour.</p>

<p>The <code class="language-plaintext highlighter-rouge">source /home/groups/oroaklab/Modules/default/init/bash; source /home/groups/oroaklab/nishida/cron/setup/profile</code> part is needed to find the modules and setup a proper bash environment for the job.</p>

<p>The last part, <code class="language-plaintext highlighter-rouge">/home/groups/oroaklab/nishida/scripts/check_obnix.sh</code>, is the script being run every hour. The comments should explain everything but it looks for new folders, validates the names, checks for the RTAcomplete.txt file, runs <code class="language-plaintext highlighter-rouge">/home/groups/oroaklab/nishida/scripts/NextSeq2fastq</code> (this should be identical to what is in the github but not what is hooked up to our module because I don’t have permissions to change the module), and validates it made the output. I had it make a lot of logs but it has been running without errors for months now so you can turn off some of the extra output going forward.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># !/usr/bin/bash

# get date
DATE=$(date +"%y%m%d_%H_%M")

# move to cron folder
cd /home/groups/oroaklab/nishida/cron

# check the last 5 directories created with the machine name
ls -dt /home/groups/oroaklab/seq/obnix/* | head -n 5 | grep "_VH00711_" &gt; obnix.$DATE.check.txt

# for each of the names...
while read i; do

	# run name
	run=$(echo $i | sed -e 's/.*\///g')

	# count underscore deliminated parts in name, should be four
	namecount=$(echo $i | sed -e 's/.*\///g' | tr '_' '\n' | wc -l)

	# second member of the name should be the machine, "VH00711"
	name=$(echo $i | sed -e 's/.*\///g' | tr '_' '\t' | cut -f 2)

	# if the name is valid...
	if [[ $name == 'VH00711' &amp;&amp; $namecount == '4' ]]; then

		# check for RTA.complete and absence of FASTQ folder
		if [[ -f "/home/groups/oroaklab/seq/obnix/$run/RTAComplete.txt" &amp;&amp; ! -d "/home/groups/oroaklab/fastq/$run" ]]; then

			# run
			sleep 600 # wait in case the RTA complete shows up earlier than it should
			echo -e "Attempting to run NextSeq2fastq for $run" &gt;&gt; obnix.$DATE.log
			perl /home/groups/oroaklab/nishida/scripts/NextSeq2fastq -N -R $run
			echo -e "Finished running NextSeq2fastq for $run" &gt;&gt; obnix.$DATE.log

			# check that backup was made
			if [[ ! -d "/home/groups/oroakdata/fastq/$run" ]]; then
				echo -e "Backup FASTQ folder was not made. Check manually." &gt;&gt; obnix.$DATE.err
			fi
		fi
	fi

done &lt; obnix.$DATE.check.txt

# save for now
#rm obnix.$DATE.check.txt
</code></pre></div></div>

<p>The only part that needs to change when someone takes over is just changing this directory to something of one’s own. The directory just holds the logs from the cron jobs.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># move to cron folder
cd /home/groups/oroaklab/nishida/cron
</code></pre></div></div>

  </div><a class="u-url" href="/2022/05/18/post-0086.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">ARSN Lab Notebook</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">ARSN Lab Notebook</li><li><a class="u-email" href="mailto:nishidaa@ohsu.edu">nishidaa@ohsu.edu</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/arsnishida"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">arsnishida</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>ARSN Lab notebook.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
